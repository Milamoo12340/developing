import { base44 } from "@/api/base44Client";

export default async function generateScript(request) {
  const { task, game = 'Roblox', type = 'Auto-Clicker' } = request.query;
  
  if (!task) {
    return {
      status: 400,
      body: 'ERROR: Missing task parameter'
    };
  }

  try {
    const response = await base44.integrations.Core.InvokeLLM({
      prompt: `Generate an AutoHotkey v2 script for ${game} that performs the following task:

${task}

Script Type: ${type}

Requirements:
- Use AutoHotkey v2 syntax
- Include clear comments explaining each section
- Add hotkeys to start/stop the script (F1 to toggle, F2 to exit)
- Include safety features and error handling
- Make it efficient and reliable

Return ONLY the AutoHotkey code without explanations.`,
      response_json_schema: {
        type: "object",
        properties: {
          script: { type: "string" }
        }
      }
    });

    return {
      status: 200,
      headers: { 'Content-Type': 'text/plain' },
      body: response.script || 'ERROR: Generation failed'
    };
  } catch (error) {
    return {
      status: 500,
      body: 'ERROR: ' + error.message
    };
  }
}
